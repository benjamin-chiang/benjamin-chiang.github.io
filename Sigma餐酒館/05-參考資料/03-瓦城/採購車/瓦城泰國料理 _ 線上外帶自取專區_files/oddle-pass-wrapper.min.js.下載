(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.opw=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){(function(global){"use strict";var getGlobal=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var global=getGlobal();module.exports=exports=global.fetch;if(global.fetch){exports.default=global.fetch.bind(global)}exports.Headers=global.Headers;exports.Request=global.Request;exports.Response=global.Response}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ClientResponse=function(){function e(){}return e.prototype.wasSuccessful=function(){return this.statusCode>=200&&this.statusCode<300},e}();exports.default=ClientResponse},{}],3:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}u((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var ClientResponse_1=require("./ClientResponse"),node_fetch_1=require("node-fetch"),EMPTY_STRING_FORMAT=/^\s+$/,DefaultRESTClient=function(){function t(e){this.host=e,this.headers={Cookie:""},this.parameters={},this.responseHandler=t.JSONResponseHandler}return t.prototype.withCookie=function(t,e){return this.headers.Cookie+=t+"="+e,this},t.prototype.withAuthorization=function(t){return null==t||""===t||EMPTY_STRING_FORMAT.test(t)?this:(this.withHeader("Authorization","Bearer "+t),this)},t.prototype.withUriSegment=function(t){return null==t?this:(null===this.uri&&(this.uri=""),"/"!==this.uri.charAt(this.uri.length-1)&&(this.uri+="/"),this.uri=this.uri+t,this)},t.prototype.getFullUrl=function(){return this.host+this.uri+this.getQueryString()},t.prototype.withHeader=function(t,e){return this.headers[t]=e,this},t.prototype.withJSONBody=function(t){return this.body=JSON.stringify(t),this.withHeader("Content-Type","application/json"),this},t.prototype.withMethod=function(t){return this.method=t,this},t.prototype.withUri=function(t){return this.uri=t,this},t.prototype.withParameter=function(t,e){return this.parameters[t]=e,this},t.prototype.withCredentials=function(t){return this.credentials=t,this},t.prototype.go=function(){return __awaiter(this,void 0,void 0,function(){var t,e,r;return __generator(this,function(n){switch(n.label){case 0:t=new ClientResponse_1.default,n.label=1;case 1:return n.trys.push([1,7,,8]),[4,node_fetch_1.default(this.getFullUrl(),{method:this.method,headers:this.headers,body:this.body,redirect:"follow",credentials:this.credentials})];case 2:return(e=n.sent()).ok?[4,this.responseHandler(e)]:[3,4];case 3:return[2,n.sent()];case 4:return[4,this.responseHandler(e)];case 5:throw n.sent();case 6:return[3,8];case 7:if((r=n.sent())instanceof ClientResponse_1.default)throw r;throw e&&(t.statusCode=e.status),t.exception=r,t;case 8:return[2]}})})},t.prototype.getQueryString=function(){var t="";for(var e in this.parameters)t+=0===t.length?"?":"&",t+=e+"="+encodeURIComponent(this.parameters[e]);return t},t.JSONResponseHandler=function(t){return __awaiter(this,void 0,void 0,function(){var e,r,n;return __generator(this,function(i){switch(i.label){case 0:return(e=new ClientResponse_1.default).statusCode=t.status,(r=t.headers.get("content-type"))&&r.startsWith("application/json")?(n=e,[4,t.json()]):[3,2];case 1:n.response=i.sent(),i.label=2;case 2:return[2,e]}})})},t}();exports.default=DefaultRESTClient},{"./ClientResponse":2,"node-fetch":1}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DefaultRESTClient_1=require("./DefaultRESTClient"),DefaultRESTClientBuilder=function(){function e(){}return e.prototype.build=function(e){return new DefaultRESTClient_1.default(e)},e}();exports.default=DefaultRESTClientBuilder},{"./DefaultRESTClient":3}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},{}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},{}],7:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(r,a){function o(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,i)}c((s=s.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var n,s,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var DefaultRESTClientBuilder_1=require("./DefaultRESTClientBuilder");function OPW(){var e=this,t={alpha:"https://accounts.alpha.oddle.me",beta:"https://accounts.beta.oddle.me",prod:"https://accounts.oddle.me"},n=t.prod,s={clientId:null,redirectUrl:null,host:n+"/api/v1",feopHost:null,credentials:null,clientBuilder:new DefaultRESTClientBuilder_1.default,payload:null,canUseIframe:!1,listener:function(){}};function r(e){return o().withUri("/customers/hash").withJSONBody({hash:e}).withMethod("POST").go()}function a(e){return o().withUri("/oauth2/verify-client").withJSONBody(__assign(__assign({},e),{clientId:s.clientId,redirectUri:s.redirectUrl})).withMethod("POST").withHeader("Content-Type","application/json").go()}function o(){return function(){var e=s.clientBuilder.build(s.host);localStorage.getItem("accessToken")&&e.withAuthorization(localStorage.getItem("accessToken"));null!=s.credentials&&e.withCredentials(s.credentials);return e}()}function i(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}function c(e){if(s.canUseIframe){var t=function(e){var t=document.createElement("style");t.type="text/css",t.innerHTML="@-webkit-keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }",document.body.appendChild(t);var n=document.createElement("div");n.id="opLoader",n.style.visibility="visible",n.style.border="7px solid rgb(57, 57, 57)",n.style.borderTop="7px solid rgba(57, 57, 57, 0.5)",n.style.borderRadius="50%",n.style.width="50px",n.style.height="50px",n.style.position="absolute",n.style.bottom="49.7%",n.style.animation="spin 2s linear infinite",n.style.webkitAnimation="spin 1s linear infinite";var s=document.createElement("div");return s.id="iframeFEOP",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.right="0",s.style.bottom="0",s.style.width="100%",s.style.height="100%",s.style.zIndex="100",s.style.display="flex",s.style.justifyContent="center",s.style.alignItems="center",e?s.style.backgroundColor=e:s.style.background="transparent",s.appendChild(n),s.appendChild(n),s}(),n=document.createElement("iframe");n.style.overflow="hidden",n.width="100%",n.height="100%",n.frameBorder="0",n.src=e,n.onload=function(){document.getElementById("opLoader").style.visibility="hidden"},n.onerror=function(){document.getElementById("iframeFEOP")&&document.getElementById("iframeFEOP").remove()},t.appendChild(n),document.body.appendChild(t)}else window.location.href=e+"&canUseIframe="+s.canUseIframe}function u(e){return null==e||""===e||/^\s+$/.test(e)}function d(){var e=new URL(window.location.href);return""+e.origin+e.pathname}return window.addEventListener("message",function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return"closeIframe"===e.data&&document.getElementById("iframeFEOP")&&document.getElementById("iframeFEOP").remove(),"showLoader"===e.data&&(document.getElementById("opLoader").style.visibility="visible"),e.data&&"facebookSignin"===e.data.action&&(localStorage.removeItem("accessToken"),localStorage.setItem("accessToken",e.data.accessToken),location.reload()),[2]})})},!1),document.addEventListener("INITIALIZED",function(){return __awaiter(e,void 0,void 0,function(){var e,t,n,a,o,u,l,f,m;return __generator(this,function(h){switch(h.label){case 0:return e=new URL(window.location.href),t=e.searchParams.getAll("access-token"),n=e.searchParams.getAll("state"),a=e.searchParams.get("is-new"),o=e.searchParams.get("hash"),u=e.searchParams.get("signout-success"),s.canUseIframe||(t&&t.length>0?(localStorage.getItem("accessToken")!==t[0]&&localStorage.setItem("accessToken",t[0]),window.history.replaceState(null,null,e.pathname),g=t[0],p=g.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),w=decodeURIComponent(atob(p).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),l=JSON.parse(w),s.listener(l.state.action,l.state.message)):u&&(localStorage.removeItem("accessToken"),window.history.replaceState(null,null,e.pathname),s.listener("signout_success"))),n&&n.length>0&&n[n.length-1].includes("viaOddlePass")?"true"!==a?[3,2]:[4,r(o).then(function(e){var t=e.response;if(t.success){var n=t.data,r=n.email,a=n.phone,o=n.firstName,u=n.lastName,l=n.facebookId,f=i({canUseIframe:s.canUseIframe,parentUrl:d(),email:r,phone:a,firstName:o,lastName:u,facebookId:l}),m=s.feopHost+"/signup?"+f;s.canUseIframe?c(m):window.location.href=m}})]:[3,4];case 1:return h.sent(),[3,3];case 2:f=i({parentUrl:d(),canUseIframe:s.canUseIframe,hash:o}),m=s.feopHost+"/signin?"+f,s.canUseIframe?c(m):window.location.href=m,h.label=3;case 3:window.history.pushState({},document.title,e.pathname),h.label=4;case 4:return[2]}var g,p,w})})}),{signIn:function(e){return new Promise(function(t,n){a({responseType:"code",scope:""}).then(function(r){if(r.response.success){var a=i(__assign({clientId:s.clientId,redirectUri:s.redirectUrl,canUseIframe:s.canUseIframe,parentUrl:d(),menuId:e},s.payload?__assign(__assign({},s.payload),{state:JSON.stringify(s.payload.state)}):{})),o=s.feopHost+"/signin?"+a;s.canUseIframe?(null!==document.getElementById("iframeFEOP")?document.getElementById("iframeFEOP").style.display="flex":c(o),window.addEventListener("message",function(e){return function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return e.data.accessToken&&(u(e.data.accessToken)||(localStorage.removeItem("accessToken"),localStorage.setItem("accessToken",e.data.accessToken)),document.getElementById("iframeFEOP")&&document.getElementById("iframeFEOP").remove(),t({success:!0,message:e.data.message,data:__assign({action:e.data.action},e.data.customer)})),"closeIframe"===e.data&&t({success:!1,data:{action:e.data}}),[2]})})}(e,t)},!1)):(window.location.href=o,t({success:!0}))}else n({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return n({success:!1,message:new Error("Cannot sign in")})})})},signOut:function(e){return new Promise(function(t,n){a({responseType:"code",scope:""}).then(function(r){if(r.response.success){var a=i({customerId:e,canUseIframe:s.canUseIframe,accessToken:localStorage.getItem("accessToken")});c(s.feopHost+"/signout?"+a),window.addEventListener("message",function(e){return function(e,t){"signoutSuccess"===e.data&&(localStorage.removeItem("accessToken"),document.getElementById("iframeFEOP")&&document.getElementById("iframeFEOP").remove(),t({success:!0,message:"Signing out in success"})),"closeIframe"===e.data&&t({success:!1,data:{action:e.data}})}(e,t)},!1)}else n({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return n({success:!1,message:new Error("Cannot sign out")})})})},changePassword:function(e,t){return new Promise(function(n,r){a({responseType:"code",scope:""}).then(function(a){if(a.response.success)if(null!==localStorage.getItem("accessToken")&&void 0!==localStorage.getItem("accessToken")){var o=i(__assign({parentUrl:d(),canUseIframe:s.canUseIframe,email:e,customerId:t},s.payload?__assign(__assign({},s.payload),{state:JSON.stringify(s.payload.state)}):{}));window.location.href=s.feopHost+"/change-password?"+o,n({success:!0})}else r({success:!1,message:new Error("Invalid Token")});else r({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return r({success:!1,message:new Error("Cannot sign out")})})})},verificationDetails:function(e,t){return new Promise(function(n,r){a({responseType:"code",scope:""}).then(function(a){if(a.response.success){var o=i(__assign({clientId:s.clientId,redirectUri:s.redirectUrl,canUseIframe:s.canUseIframe,parentUrl:d(),menuId:e,customerId:t},s.payload?__assign(__assign({},s.payload),{state:JSON.stringify(s.payload.state)}):{})),l=s.feopHost+"/verification?"+o;s.canUseIframe?(null!==document.getElementById("iframeFEOP")?document.getElementById("iframeFEOP").style.display="flex":c(l),window.addEventListener("message",function(e){return function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return"verification"===e.data.action&&(u(e.data.accessToken)||(localStorage.removeItem("accessToken"),localStorage.setItem("accessToken",e.data.accessToken)),document.getElementById("iframeFEOP")&&document.getElementById("iframeFEOP").remove(),t({success:!0,message:e.data.message,data:__assign({action:e.data.action},e.data.customer)})),"closeIframe"===e.data&&t({success:!1,data:{action:e.data}}),[2]})})}(e,n)},!1)):(window.location.href=l,n({success:!0}))}else r({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return r({success:!1,message:new Error("Cannot sign in")})})})},initializeApp:function(e,r,a,o){var i=this;void 0===a&&(a="en_SG"),window.addEventListener("message",function(t){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(i){return"check3rdCookies"===t.data.action&&(s.canUseIframe=t.data.isSupport,s.clientId=e,s.redirectUrl=r,s.feopHost=n+"/"+(a||"en_SG")+"/oauth2",o&&(s.payload={menuName:o.menuName,disableMarketingMenu:o.disableMarketingMenu||!1,state:o.state||{},useIframe:void 0===o.useIframe||o.useIframe}),document.dispatchEvent(new Event("INITIALIZED"))),[2]})})},!1);var c=document.createElement("iframe");c.id="testThirdPartyCookie",c.style.display="none",c.width="100%",c.height="100%",c.frameBorder="0",c.src=t.prod+"/js-lib/test-third-party-cookie",document.body.appendChild(c)},getCustomerInfo:function(){return new Promise(function(e,t){a({responseType:"code",scope:""}).then(function(n){if(n.response.success)return o().withUri("/customers").withMethod("GET").go().then(function(t){var n=t.response;e(n)});t({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return t({success:!1,message:new Error("Cannot get customer information")})})})},updateCustomerDetails:function(e,t){return new Promise(function(n,s){a({responseType:"code",scope:""}).then(function(r){if(r.response.success)return o().withUri("/customers/"+e).withJSONBody(__assign({},t)).withMethod("PUT").go().then(function(e){var t=e.response;n(t)});s({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return s({success:!1,message:new Error("Cannot update customer")})})})},getAllAddress:function(){return new Promise(function(e,t){a({responseType:"code",scope:""}).then(function(n){if(n.response.success)return o().withUri("/addresses").withMethod("GET").go().then(function(t){var n=t.response;e(n)});t({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return t({success:!1,message:new Error("Cannot get address")})})})},getAddressById:function(e){return new Promise(function(t,n){a({responseType:"code",scope:""}).then(function(s){if(s.response.success)return o().withUri("/addresses/"+e).withMethod("GET").go().then(function(e){var n=e.response;t(n)});n({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return n({success:!1,message:new Error("Cannot get address")})})})},deleteAddress:function(e){return new Promise(function(t,n){a({responseType:"code",scope:""}).then(function(s){if(s.response.success)return o().withUri("/addresses/"+e).withMethod("DELETE").go().then(function(e){var n=e.response;t(n)});n({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return n({success:!1,message:new Error("Cannot delete address")})})})},updateAddress:function(e,t){return new Promise(function(n,s){a({responseType:"code",scope:""}).then(function(r){if(r.response.success)return o().withUri("/addresses/"+e).withJSONBody(__assign({},t)).withMethod("PUT").go().then(function(e){var t=e.response;n(t)});s({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return s({success:!1,message:new Error("Cannot delete address")})})})},setReferredDeliveryAddress:function(e,t){return new Promise(function(n,s){a({responseType:"code",scope:""}).then(function(r){if(r.response.success)return o().withUri("/customers/"+t+"/addresses/"+e).withMethod("PUT").go().then(function(e){var t=e.response;n(t)});s({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return s({success:!1,message:new Error("Cannot delete address")})})})},createNewAddress:function(e,t){return new Promise(function(n,s){a({responseType:"code",scope:""}).then(function(r){if(r.response.success)return o().withUri("/addresses").withJSONBody(__assign({customerId:e},t)).withMethod("POST").go().then(function(e){var t=e.response;n(t)});s({success:!1,message:new Error("This client hasn't registered")})}).catch(function(){return s({success:!1,message:new Error("Cannot create new address")})})})},checkCanUseIframe:function(){return s.canUseIframe},addListener:function(e){s.listener=e}}}module.exports=OPW()},{"./DefaultRESTClientBuilder":4}]},{},[2,3,4,5,6,7])(7)});